<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ToDo + ポモドーロ</title>
<style>

/* ===== 変数（ライトテーマ） ===== */

:root{

  --bg-main:#fdf6e3; --card-bg:#fff; --card-shadow:0 4px 12px rgba(0,0,0,.1);

  --txt-main:#2a2a2a; --txt-muted:#666; --accent:#268bd2;

  --prio-low:#2aa198; --prio-mid:#ff9800; --prio-hi:#dc322f;

}

/* ===== ダーク ===== */

body.dark{

  --bg-main:#1e1e1e; --card-bg:#2c2c2c; --card-shadow:0 4px 12px rgba(0,0,0,.6);

  --txt-main:#eaeaea; --txt-muted:#aaa;

}

*{box-sizing:border-box;}

body{

  margin:0;padding:2rem;font:16px/1.5 "Helvetica Neue",sans-serif;

  background:var(--bg-main);color:var(--txt-main);transition:.2s;

}

h1{margin:0 0 1rem;text-align:center;font-size:clamp(1.8rem,3vw,2.4rem);display:flex;justify-content:center;gap:.8rem;}

#theme-toggle{font-size:1.2rem;padding:.3rem .6rem;border:none;border-radius:4px;cursor:pointer;background:var(--accent);color:#fff;}

section{background:var(--card-bg);border-radius:8px;padding:1.5rem;box-shadow:var(--card-shadow);}

.container{display:grid;gap:1.5rem;}@media(min-width:750px){.container{grid-template-columns:1fr 1fr;}}

input[type="text"],input[type="number"],input[type="date"],select,button{

  padding:.5rem .75rem;border:1px solid #ccc;border-radius:4px;font-size:1rem;

}

button{cursor:pointer;background:var(--accent);color:#fff;border:none;transition:filter .2s;}

button:hover{filter:brightness(.9);}button:disabled{opacity:.5;cursor:not-allowed;}

ul{list-style:none;margin:.5rem 0 0;padding:0;}

li{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #eee;padding:.6rem 0;}

body.dark li{border-bottom:1px solid #444;}li:last-child{border-bottom:none;}

.task{display:flex;align-items:center;gap:.6rem;flex-wrap:wrap;}

.priority-dot{width:.8rem;height:.8rem;border-radius:50%;}

.priority-low{background:var(--prio-low);} .priority-mid{background:var(--prio-mid);} .priority-hi{background:var(--prio-hi);}

.priority-label{font-size:.85rem;font-weight:bold;}

.priority-low  + .priority-label{color:var(--prio-low);}

.priority-mid  + .priority-label{color:var(--prio-mid);}

.priority-hi   + .priority-label{color:var(--prio-hi);}

.date-label{font-size:.8rem;color:var(--txt-muted);}

.completed .text{text-decoration:line-through;}

.filter-group{margin-top:.8rem;display:flex;gap:.4rem;}

.sort-wrapper{margin-top:.8rem;position:relative;display:inline-block;}

#sort-menu{position:absolute;top:110%;right:0;background:var(--card-bg);border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,.2);display:none;z-index:10;}

#sort-menu button{display:block;width:100%;text-align:left;padding:.5rem 1rem;background:none;color:var(--txt-main);}

#sort-menu button:hover{background:rgba(0,0,0,.05);}

body.dark #sort-menu button:hover{background:rgba(255,255,255,.05);}

#timer-display{font-size:clamp(2.5rem,5vw,3.2rem);margin:.5rem 0;}

#progress-wrap{width:100%;height:8px;background:#eee;border-radius:4px;overflow:hidden;margin-bottom:1rem;}

body.dark #progress-wrap{background:#444;}

#progress-bar{height:100%;width:0;background:var(--accent);transition:width 1s linear;}

.time-inputs{display:flex;justify-content:center;gap:.6rem;margin-bottom:.8rem;}

@keyframes flashBlink{0%,100%{background:var(--bg-main);}50%{background:#fffacd;}}

body.flash{animation:flashBlink .4s ease-in-out 3;}
</style>
</head>
<body>
<h1>ToDo + ポモドーロ <button id="theme-toggle" title="テーマ切替">🌙</button></h1>
<div class="container">
<!-- ===== ToDo ===== -->
<section id="todo-card">
<h2>📝 ToDoリスト</h2>
<div style="display:flex;flex-wrap:wrap;gap:.5rem">
<input type="text"  id="todo-input"  placeholder="やること..." style="flex:1 1 160px;">
<input type="date"  id="date-input"  style="flex:0 0 150px;">
<select            id="priority-select">
<option value="low">低</option><option value="mid" selected>中</option><option value="hi">高</option>
</select>
<button id="add-btn">追加</button>
</div>
<div class="filter-group">
<button data-filter="all">すべて</button>
<button data-filter="active">未完了</button>
<button data-filter="done">完了</button>
<div class="sort-wrapper">
<button id="sort-btn">並び替え ▼</button>
<div id="sort-menu">
<button data-sort="prio">優先度（高→低）</button>
<button data-sort="due">締切が近い順</button>
<button data-sort="orig">登録順に戻す</button>
</div>
</div>
</div>
<ul id="todo-list"></ul>
</section>
<!-- ===== Timer ===== -->
<section id="timer-card">
<h2>⏱ ポモドーロタイマー</h2>
<div class="time-inputs">
<label>作業 <input type="number" id="work-min" value="25" min="1" max="60">分</label>
<label>休憩 <input type="number" id="break-min" value="5"  min="1" max="30">分</label>
</div>
<div id="timer-display">25:00</div>
<div id="progress-wrap"><div id="progress-bar"></div></div>
<button id="start-btn">スタート</button>
<button id="pause-btn">一時停止</button>
<button id="reset-btn">リセット</button>
</section>
</div>
<script>

/* ===== テーマ切替 ===== */

const bodyEl = document.body; const themeBtn = document.getElementById("theme-toggle");

if(localStorage.getItem("theme")==="dark"){bodyEl.classList.add("dark");themeBtn.textContent="☀️";}

themeBtn.onclick = ()=>{bodyEl.classList.toggle("dark");

  const mode = bodyEl.classList.contains("dark")?"dark":"light";

  themeBtn.textContent = mode==="dark"?"☀️":"🌙";

  localStorage.setItem("theme",mode);

};

/* ===== ToDo ===== */

let todos = JSON.parse(localStorage.getItem("todos")||"[]");   // {text,prio,done,due,created}

let currentFilter = localStorage.getItem("filter")||"all";

let sortMode = "orig";                                         // orig | prio | due

const todoInput   = document.getElementById("todo-input");

const dateInput   = document.getElementById("date-input");

const prioSel     = document.getElementById("priority-select");

const listEl      = document.getElementById("todo-list");

document.getElementById("add-btn").onclick = addTodo;

document.querySelectorAll(".filter-group button[data-filter]").forEach(btn=>btn.onclick=()=>{currentFilter=btn.dataset.filter;localStorage.setItem("filter",currentFilter);render();});

/* --- ソートメニュー --- */

const sortBtn=document.getElementById("sort-btn"),sortMenu=document.getElementById("sort-menu");

sortBtn.onclick = ()=>{sortMenu.style.display = sortMenu.style.display?"":"block";}

sortMenu.onclick = e=>{

  if(e.target.dataset.sort){sortMode=e.target.dataset.sort;sortMenu.style.display="none";render();}

};

document.addEventListener("click",e=>{if(!sortBtn.contains(e.target)&&!sortMenu.contains(e.target))sortMenu.style.display="none";});

function addTodo(){

  const text=todoInput.value.trim(),due=dateInput.value;

  if(!text) return;

  todos.push({text,prio:prioSel.value,done:false,due,created:Date.now()});

  todoInput.value="";dateInput.value="";save();render();

}

function toggle(i){todos[i].done=!todos[i].done;save();render();}

function move(i,dir){           // dir = -1 or +1

  const j=i+dir;if(j<0||j>=todos.length)return;

  [todos[i],todos[j]]=[todos[j],todos[i]];save();render();

}

function del(i){todos.splice(i,1);save();render();}

function editText(i,span){

  const inp=document.createElement("input");inp.value=todos[i].text;

  inp.onblur=()=>{todos[i].text=inp.value.trim()||todos[i].text;save();render();};

  span.replaceWith(inp);inp.focus();

}

function cyclePrio(p){return p==="low"?"mid":p==="mid"?"hi":"low";}

function changePrio(i){todos[i].prio=cyclePrio(todos[i].prio);save();render();}

function editDue(i,span){

  const inp=document.createElement("input");inp.type="date";inp.value=todos[i].due;

  inp.onblur=()=>{todos[i].due=inp.value;save();render();};

  span.replaceWith(inp);inp.focus();

}

function sortTodos(arr){

  if(sortMode==="prio"){

    const rank={hi:0,mid:1,low:2};

    arr.sort((a,b)=>rank[a.prio]-rank[b.prio]||a.created-b.created);

  }else if(sortMode==="due"){

    arr.sort((a,b)=>{

      if(a.due&&b.due) return a.due.localeCompare(b.due);

      if(a.due) return -1; if(b.due) return 1;

      return a.created-b.created;

    });

  }else{ arr.sort((a,b)=>a.created-b.created);} // orig

}

function render(){

  listEl.innerHTML="";

  const view = todos.filter(t=>currentFilter==="all"||t.done===(currentFilter==="done"));

  sortTodos(view);

  view.forEach((t,idxInView)=>{

    const i=todos.indexOf(t); // 元配列 index

    const li=document.createElement("li");if(t.done)li.classList.add("completed");

    const prioLabel=t.prio==="low"?"低":t.prio==="mid"?"中":"高";

    li.innerHTML=`
<div class="task">
<input type="checkbox" ${t.done?"checked":""}/>
<span class="priority-dot priority-${t.prio}" title="クリックで変更"></span>
<span class="priority-label">${prioLabel}</span>
<span class="text">${t.text}</span>

        ${t.due?`<span class="date-label">(〆 ${t.due})</span>`:""}
</div>
<div style="display:flex;gap:.3rem">
<button title="上へ">⬆️</button>
<button title="下へ">⬇️</button>
<button>削除</button>
</div>`;

    const chk=li.querySelector("input");

    chk.onclick=()=>toggle(i);

    li.querySelector(".priority-dot").onclick=()=>changePrio(i);

    const txtSpan=li.querySelector(".text");txtSpan.ondblclick=()=>editText(i,txtSpan);

    const dateSpan=li.querySelector(".date-label");if(dateSpan)dateSpan.ondblclick=()=>editDue(i,dateSpan);

    const buttons=li.querySelectorAll("button");

    buttons[0].onclick=()=>move(i,-1); // up

    buttons[1].onclick=()=>move(i,+1); // down

    buttons[2].onclick=()=>del(i);     // delete

    listEl.appendChild(li);

  });

}

function save(){localStorage.setItem("todos",JSON.stringify(todos));}

render();

/* ===== タイマー ===== */

const workInput=document.getElementById("work-min"),breakInput=document.getElementById("break-min");

const display=document.getElementById("timer-display"),progress=document.getElementById("progress-bar");

let isWork=true,timer=null,totalSec=1500,leftSec=1500;

function updateDisp(){const m=String(Math.floor(leftSec/60)).padStart(2,"0"),s=String(leftSec%60).padStart(2,"0");

  display.textContent=`${m}:${s}`;progress.style.width=`${(1-leftSec/totalSec)*100}%`;}

function flash(){bodyEl.classList.add("flash");setTimeout(()=>bodyEl.classList.remove("flash"),1200);}

function start(){if(timer)return;timer=setInterval(()=>{leftSec--;updateDisp();if(leftSec<=0)switchMode();},1000);}

function pause(){clearInterval(timer);timer=null;}

function reset(){pause();isWork=true;totalSec=leftSec=workInput.value*60;updateDisp();}

function switchMode(){pause();flash();isWork=!isWork;totalSec=leftSec=(isWork?workInput.value:breakInput.value)*60;

  alert(isWork?"作業時間です！":"休憩しましょう！");updateDisp();start();}

document.getElementById("start-btn").onclick=start;

document.getElementById("pause-btn").onclick=pause;

document.getElementById("reset-btn").onclick=reset;

workInput.onchange=breakInput.onchange=reset;

reset();
</script>
</body>
</html>
 